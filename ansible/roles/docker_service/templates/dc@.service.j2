# Thanks https://github.com/MiGoller/dc-systemd-template#creating-docker-compose-powered-services-using-systemd-templates
[Unit]
Description=%i service powered by docker compose

[Service]
# Restart each day by resetting data - https://stackoverflow.com/a/50332245
# Only for betisier
#RuntimeMaxSec=1d

Restart=always
TimeoutStartSec=300
#   Create a directory for each docker composed service at /opt/dockerfiles.
#   Name the directory as the service.
WorkingDirectory=/opt/apps/%i

#   Remove old containers, images and volumes and update it
ExecStartPre=/usr/bin/docker compose down
ExecStartPre=/usr/bin/docker compose rm -f
#   Comment the following to not automatically update your images!
#ExecStartPre=/usr/bin/docker compose pull

#   Run Compose up on service start.
ExecStart=/usr/bin/docker compose up

#   Run Compose down, remove containers and volumes on service stop.
ExecStop=/usr/bin/docker compose down

# TODO init container docker compose instead of curl
#ExecStartPre=/usr/bin/curl healcheckurl

[Install]
WantedBy=multi-user.target
