[tools]
uv = "0.9"
python = "{{ get_env(name='PYTHON_VERSION', default='3.14') }}"

[settings]
python.uv_venv_auto = true

[env]
# Use the project name derived from the current directory
PROJECT_NAME = "{{ config_root | basename }}"

[tasks.info]
description = "Print project information"
run = '''
echo "Project: $PROJECT_NAME"
echo "Virtual Environment: $VIRTUAL_ENV"
'''

[tasks.install]
description = "Install project dependencies"
run = [
    'ansible-galaxy role install -r "requirements.yml"',
    'ansible-galaxy collection install -r "requirements.yml"'
]
sources = ['requirements.yml']

[tasks.lint]
description = "Run ansible-lint"
run = "ansible-lint"

[tasks.lint-fix]
description = "Run ansible-lint with auto-fix"
run = "ansible-lint --fix"

[tasks.ssh]
description = "SSH into the managed host"
run = '''
ip=$(ansible-inventory --host docker  | jq -r '.ansible_default_ipv4.address')
ssh -i ~/.ssh/keepassxc.pub sylvain@$ip
'''
raw = true
